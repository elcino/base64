<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>MP4 to Base64 Export Tool</title>
</head>
<body>
  <h2>Video 1 Upload</h2>
  <input type="file" id="video1Input" accept="video/mp4"><br><br>
  <textarea id="video1Base64" rows="5" cols="80" placeholder="Video 1 base64..."></textarea>

  <h2>Video 2 Upload</h2>
  <input type="file" id="video2Input" accept="video/mp4"><br><br>
  <textarea id="video2Base64" rows="5" cols="80" placeholder="Video 2 base64..."></textarea>

  <br><br>
  <button onclick="exportHTML()">Export HTML</button>

  <script>
    function encodeVideo(file, callback) {
      const reader = new FileReader();
      reader.onload = function (e) {
        const base64 = e.target.result.split(',')[1];
        callback(base64);
      };
      reader.readAsDataURL(file);
    }

    document.getElementById('video1Input').addEventListener('change', function () {
      const file = this.files[0];
      if (!file) return;
      encodeVideo(file, function (base64) {
        document.getElementById('video1Base64').value = base64;
      });
    });

    document.getElementById('video2Input').addEventListener('change', function () {
      const file = this.files[0];
      if (!file) return;
      encodeVideo(file, function (base64) {
        document.getElementById('video2Base64').value = base64;
      });
    });

    function exportHTML() {
      const video1 = document.getElementById('video1Base64').value.trim();
      const video2 = document.getElementById('video2Base64').value.trim();

      const htmlContent = `
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Playable Video</title>
</head>
<body>
  <video id="mainVideo" autoplay muted loop playsinline style="width: 100%; height: 100%; object-fit: cover;"></video>
  <script>
    let isSecondVideo = false;
    let hasSecondVideoPlayed = false;

    const video1Base64 = "${video1}";
    const video2Base64 = "${video2}";

    window.onload = function () {
      const video = document.getElementById("mainVideo");

      video.src = "data:video/mp4;base64," + video1Base64;
      video.loop = true;
      video.muted = true;
      video.autoplay = true;
      video.load();
      video.play();

      video.addEventListener("touchstart", function (e) {
        if (isSecondVideo) return;
        touchStartX = e.touches[0].clientX;
      });

      video.addEventListener("touchend", function (e) {
        if (isSecondVideo) return;
        const dx = e.changedTouches[0].clientX - touchStartX;
        const swipeThreshold = 50;
        if (Math.abs(dx) > swipeThreshold) {
          handleSwipe();
        }
      });
    };

    let touchStartX = 0;

    function handleSwipe() {
      const video = document.getElementById("mainVideo");
      isSecondVideo = true;

      video.loop = false;
      video.muted = false;
      video.src = "data:video/mp4;base64," + video2Base64;
      video.load();
      video.play();

      video.addEventListener("ended", function () {
        hasSecondVideoPlayed = true;
        document.body.addEventListener("click", handleFinalClick);
        document.body.addEventListener("touchstart", handleFinalClick);
      }, { once: true });
    }

    function handleFinalClick(e) {
      e.preventDefault();
      mraid.open('');
    }
  </script>
</body>
</html>`;

      const blob = new Blob([htmlContent], { type: 'text/html' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'playable.html';
      a.click();
    }
  </script>
</body>
</html>
